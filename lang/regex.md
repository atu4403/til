# WIP

## `*`と`+`と`?`の違い

文字列`"123,456,789"`から`123`、`456`、`789`を抽出したい。まず思いついた正規表現は`(\d*)(\d*)(\d*)`だった。

```python
s = "123,456,789"
m = re.search(r"(\d*)(\d*)(\d*)", s)
g = m.group(0, 1, 2, 3)
print(g)
# ('123', '123', '', '')
```

`*`じゃなく`+`だと思い変更してみる。

```python
"(\d+)(\d+)(\d+)"
# ('123', '1', '2', '3')
```

また間違っているので修正。

```python
"(\d*),(\d*),(\d*)"
# ('123,456,789', '123', '456', '789')
```

これは期待する動作をしてくれた。（ちなみに`(\d+),(\d+),(\d+)`でもOK）

今まではこのようにトライアンドエラーで試してみて、期待する動作ならOKとしてコードを書いてきた。
もし「文字列`"123,456,789"`から`123`、`456`、`789`を抽出する方法」を聞かれたら答えることができるが「なぜ`(\d*)(\d*)(\d*)`ではダメなのか」を聞かれたらすぐには答えられないと思い、ちゃんと考えてみる。

## `(\d*)(\d*)(\d*)`と`(\d*),(\d*),(\d*)`の検索方法

## 正規表現の種類

|               |     |                             |
|:--------------|:----|:----------------------------|
| 単純正規表現  | SRE | 基本となるもの。多くの言語で廃止予定 |
| 基本正規表現  | BRE | UNIXのデフォルト(grepやsed)        |
| 拡張正規表現  | ERE | `*+?`を追加                  |
| Perlの正規表現 | -   | `\d`等を追加                 |

多くの言語ではPerlに準じている。

## 正規表現の内部動作

- reg(正規表現)
- str(検索文字列)

1. regを1ブロックずつ検索文字列にマッチするか確認
   1. マッチするならregを増やす
   2. マッチしないならstrを減らす
   3. マッチしないままstrがなくなればstrの開始位置を右にずらして最初からやりなおし

補足

- `*+?`は前の文字との関係が必要なので1文字ではなく1ブロックと表す
- `.*`は最長マッチなので解釈できる最長のマッチを取る

### 例題

reg = `<abc.*>x`
str = `<abcde>zy`

| reg        | str         | match | 備考                                              |
|:-----------|:------------|:------|:--------------------------------------------------|
| `<`        | `<`         | ○     | マッチ成功なのでregを増やす                                |
| `<a`       | `<a`        | ○     |                                                   |
| `<ab`      | `<ab`       | ○     |                                                   |
| `<abc`     | `<abc`      | ○     |                                                   |
| `<abc.*`   | `<abcde>zy` | ○     |                                                   |
| `<abc.*>`  | `<abcde>zy` | ×     | マッチ失敗なのでstrを減らしていく                             |
| `<abc.*>`  | `<abcde>z`  | ×     |                                                   |
| `<abc.*>`  | `<abcde>`   | ○     | マッチ成功なのでregを増やす                                |
| `<abc.*>x` | `<abcde>`   | ×     | マッチ失敗なのでstrを減らしていく                             |
| `<abc.*>x` | `<abcde`    | ×     |                                                   |
| `<abc.*>x` | `<abcd`     | ×     |                                                   |
| `<abc.*>x` | `<abc`      | ×     |                                                   |
| `<abc.*>x` | `<ab`       | ×     |                                                   |
| `<abc.*>x` | `<a`        | ×     |                                                   |
| `<abc.*>x` | `<`         | ×     |                                                   |
| `<abc.*>x` |             | ×     | マッチ失敗かつstrが無いのでstrの開始位置を右にずらして最初からやりなおし |
| `<`        | `a`         | ×     |                                                   |
| `<`        | `b`         | ×     |                                                   |
| `<`        | `c`         | ×     |                                                   |
| `<`        | `d`         | ×     |                                                   |
| `<`        | `e`         | ×     |                                                   |
| `<`        | `>`         | ×     |                                                   |
| `<`        | `z`         | ×     |                                                   |
| `<`        | `y`         | ×     | マッチ失敗かつstrが右まで来たのでマッチしないことが決定               |
